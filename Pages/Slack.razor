@page "/slack"
@inject HttpClient Http
<h1 class="text-center text-primary">Slack</h1>
<hr>

<div class="d-flex flex-column align-items-center justify-content-center">
    <div>
        <button class="btn btn-primary btn-lg" @onclick="ForcePost">Force post to slack!</button>
    </div>
    <Collapse Title="Post new slack setting">     
        <div class="d-flex flex-column align-items-center justify-content-center">
            <div class="form-group">
                <label>Bot Token</label>
                <input type="text" class="form-control" @bind="BotToken" />
            </div>
            <div class="form-group">
                <label>Channel Name</label>
                <input type="text" class="form-control" @bind="ChannelName" />
            </div>
            <div class="form-group">
                <label>Bot Id</label>
                <input type="text" class="form-control" @bind="BotId" />
            </div>
            <div class="form-group">
                <label>Id</label>
                <input type="text" class="form-control" @bind="Id" disabled="true"/>
            </div>
            <button class="btn btn-primary btn-lg" @onclick="PostSetting">Post Setting!</button>
        </div>
    </Collapse>
</div>


<ConfirmDialog @ref="Confirm" />
<MessageBox @ref="MessageBox"/>


@code {
    ConfirmDialog Confirm;
    MessageBox MessageBox;

    string BotToken;
    string ChannelName;
    string BotId;
    string Id;

    private async Task ForcePost(){
        Confirm.Prompt("Are you sure you want to post to slack?");
        while(Confirm.Show == true)
            await Task.Delay(500);
        
        if(Confirm.Value)
            await Http.PostJsonAsync("https://lunchagent.azurewebsites.net/api/slack/forcepost", "");

        await MessageBox.ShowMessage("Posted successfully");
    }

    private async Task PostSetting(){
        Confirm.Prompt("Are you sure you want replace settings by new one?");
        while(Confirm.Show == true)
            await Task.Delay(500);

        @* if(Confirm.Value)
            await Http.PostJsonAsync("https://lunchagent.azurewebsites.net/api/slack/forcepost", ""); *@

        await MessageBox.ShowMessage("Posted successfully");
    }
}